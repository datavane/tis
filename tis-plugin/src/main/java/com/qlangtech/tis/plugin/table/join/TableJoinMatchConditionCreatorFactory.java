/** * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements.  See the NOTICE file * distributed with this work for additional information * regarding copyright ownership.  The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License.  You may obtain a copy of the License at * <p> * http://www.apache.org/licenses/LICENSE-2.0 * <p> * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package com.qlangtech.tis.plugin.table.join;import com.alibaba.citrus.turbine.Context;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import com.qlangtech.tis.extension.IPropertyType;import com.qlangtech.tis.manage.common.Option;import com.qlangtech.tis.plugin.datax.SelectedTab;import com.qlangtech.tis.plugin.ds.CMeta;import com.qlangtech.tis.plugin.ds.ColumnMetaData;import com.qlangtech.tis.plugin.ds.ElementCreatorFactory;import com.qlangtech.tis.plugin.ds.ViewContent;import com.qlangtech.tis.runtime.module.misc.IControlMsgHandler;import com.qlangtech.tis.util.IPluginContext;import java.util.List;import java.util.Objects;import java.util.function.BiConsumer;import java.util.stream.Collectors;/** * * @author 百岁 (baisui@qlangtech.com) * @date 2026/1/15 */public class TableJoinMatchConditionCreatorFactory implements ElementCreatorFactory<TableJoinMatchCondition> {    public static final String KEY_TARGET_TABLE_SELECTABLE_COLS = "targetTableSelectableCols";    public static final String KEY_SOURCE_TAB_COLS = "multiStepSourceTabCols";    public static String getTargetTableColsKey() {        return TableJoinMatchConditionCreatorFactory.class.getName() + "." + KEY_TARGET_TABLE_SELECTABLE_COLS;    }    /**     * 取得目标端列集合     *     * @return     */    public static List<CMeta> getTargetCols() {        @SuppressWarnings("all") List<ColumnMetaData> cols = (List<ColumnMetaData>) Objects.requireNonNull( //                IPluginContext.getThreadLocalInstance().getContext().get(getTargetTableColsKey()) //                , "targetTableCols can not be null");        return cols.stream().map(ColumnMetaData::convert).collect(Collectors.toList());    }    @Override    public CMeta.ParsePostMCols<TableJoinMatchCondition> //    parsePostMCols( //                    IPropertyType propertyType, IControlMsgHandler msgHandler, Context context, String keyColsMeta,                    JSONArray targetCols) {        CMeta.ParsePostMCols<TableJoinMatchCondition> conditions = new CMeta.ParsePostMCols<>();        return conditions;    }    @Override    public void appendExternalJsonProp(IPropertyType propertyType, JSONObject biz) {        biz.put("targetTabCols", getTargetCols());        // 放在客户端的payload中传到服务端来的，然后再往客户端回传回去        biz.put(KEY_SOURCE_TAB_COLS,                IPluginContext.getThreadLocalInstance().getJSONPostContent().getJSONArray(KEY_SOURCE_TAB_COLS));    }    @Override    public ViewContent getViewContentType() {        return ViewContent.TableJoinMatchCondition;    }    @Override    public TableJoinMatchCondition createDefault(JSONObject targetCol) {        TableJoinMatchCondition dftCondition = new TableJoinMatchCondition();        return dftCondition;    }    @Override    public TableJoinMatchCondition create(JSONObject targetCol, BiConsumer<String, String> errorProcess) {        TableJoinMatchCondition condition = new TableJoinMatchCondition();        return condition;    }}