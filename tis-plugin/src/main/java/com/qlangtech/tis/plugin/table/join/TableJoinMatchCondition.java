/** * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements.  See the NOTICE file * distributed with this work for additional information * regarding copyright ownership.  The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License.  You may obtain a copy of the License at * <p> * http://www.apache.org/licenses/LICENSE-2.0 * <p> * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package com.qlangtech.tis.plugin.table.join;import com.alibaba.fastjson.annotation.JSONField;import com.qlangtech.tis.plugin.ds.DataType;import com.qlangtech.tis.plugin.ds.IMultiElement;import java.sql.PreparedStatement;import java.sql.SQLException;import java.util.Objects;/** * 表A和表B 执行join逻辑中 ，描述表join的 多个and条件 的match condition * * @author 百岁 (baisui@qlangtech.com) * @date 2026/1/15 */public class TableJoinMatchCondition implements IMultiElement {    private String primaryTableMatchColName;    private String dimensionMatchColName;    private DataType dimensionMatchColType;    private transient PreparedStatementSetter _preparedStatementSetter;    public DataType getDimensionMatchColType() {        return dimensionMatchColType;    }    public void setDimensionMatchColType(DataType dimensionMatchColType) {        this.dimensionMatchColType = dimensionMatchColType;    }    /**     * 维度表对应字段是否是字符串类型，以此判断是否应该在拼接SQL字符串上使用单引号     *     * @return     */    @JSONField(serialize = false)    public PreparedStatementSetter preparedStatementSetter() {        if (this._preparedStatementSetter == null) {            this._preparedStatementSetter //                    = Objects.requireNonNull(getDimensionMatchColType(), "dimensionMatchColType can not be null") //                    .accept(new DataType.TypeVisitor<>() {                        @Override                        public PreparedStatementSetter intType(DataType type) {                            return new PreparedStatementSetter() {                                @Override                                public void setVal(PreparedStatement ps, int paramIndex, Object primaryVal) throws SQLException {                                    ps.setInt(paramIndex + 1, ((Number) primaryVal).intValue());                                }                            };                        }                        @Override                        public PreparedStatementSetter bigInt(DataType type) {                            return (ps, paramIndex, val) -> {                                ps.setLong(paramIndex + 1, ((Number) val).longValue());                            };                        }                        @Override                        public PreparedStatementSetter floatType(DataType type) {                            return (ps, paramIndex, val) -> {                                ps.setFloat(paramIndex + 1, ((Number) val).floatValue());                            };                        }                        @Override                        public PreparedStatementSetter doubleType(DataType type) {                            return (ps, paramIndex, val) -> {                                ps.setDouble(paramIndex + 1, ((Number) val).doubleValue());                            };                        }                        @Override                        public PreparedStatementSetter decimalType(DataType type) {                            //                    return (ps, paramIndex, val) -> {                            //                            //                    };                            throw new UnsupportedOperationException();                        }                        @Override                        public PreparedStatementSetter dateType(DataType type) {                            throw new UnsupportedOperationException();                            //                    return (ps, paramIndex, val) -> {                            //                            //                    };                        }                        @Override                        public PreparedStatementSetter timeType(DataType type) {                            throw new UnsupportedOperationException();                            //                    return (ps, paramIndex, val) -> {                            //                            //                    };                        }                        @Override                        public PreparedStatementSetter timestampType(DataType type) {                            throw new UnsupportedOperationException();                            //                    return (ps, paramIndex, val) -> {                            //                            //                    };                        }                        @Override                        public PreparedStatementSetter bitType(DataType type) {                            return (ps, paramIndex, val) -> {                                ps.setByte(paramIndex + 1, (Byte) val);                            };                        }                        @Override                        public PreparedStatementSetter blobType(DataType type) {                            throw new UnsupportedOperationException();                            //                    return (ps, paramIndex, val) -> {                            //                            //                    };                        }                        @Override                        public PreparedStatementSetter varcharType(DataType type) {                            return (ps, paramIndex, val) -> {                                ps.setString(paramIndex + 1, (String) val);                            };                        }                        @Override                        public PreparedStatementSetter tinyIntType(DataType dataType) {                            return (ps, paramIndex, val) -> {                                ps.setShort(paramIndex + 1, ((Number) val).shortValue());                            };                        }                        @Override                        public PreparedStatementSetter smallIntType(DataType dataType) {                            return (ps, paramIndex, val) -> {                                ps.setShort(paramIndex + 1, ((Number) val).shortValue());                            };                        }                        @Override                        public PreparedStatementSetter boolType(DataType dataType) {                            return (ps, paramIndex, val) -> {                                ps.setShort(paramIndex + 1, ((Number) val).shortValue());                            };                        }                    });        }        return this._preparedStatementSetter;    }    public interface PreparedStatementSetter {        /**         * @param ps         * @param paramIndex 从0开始         * @param primaryVal         */        public void setVal(PreparedStatement ps, int paramIndex, Object primaryVal) throws SQLException;    }    public String getPrimaryTableMatchColName() {        return this.primaryTableMatchColName;    }    public void setPrimaryTableMatchColName(String primaryTableMatchColName) {        this.primaryTableMatchColName = primaryTableMatchColName;    }    public String getDimensionMatchColName() {        return this.dimensionMatchColName;    }    public void setDimensionMatchColName(String dimensionMatchColName) {        this.dimensionMatchColName = dimensionMatchColName;    }    @Override    public String getName() {        return "";    }}