/** * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements.  See the NOTICE file * distributed with this work for additional information * regarding copyright ownership.  The ASF licenses this file * to you under the Apache License, Version 2.0 (the * "License"); you may not use this file except in compliance * with the License.  You may obtain a copy of the License at * <p> * http://www.apache.org/licenses/LICENSE-2.0 * <p> * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package com.qlangtech.tis.plugin.items.manager;import com.alibaba.citrus.turbine.Context;import com.google.common.collect.Lists;import com.qlangtech.tis.extension.Describable;import com.qlangtech.tis.extension.Descriptor;import com.qlangtech.tis.extension.NoStorePlaceholderPlugin;import com.qlangtech.tis.manage.common.AppAndRuntime;import com.qlangtech.tis.manage.common.Option;import com.qlangtech.tis.plugin.IPluginStore;import com.qlangtech.tis.plugin.IdentityName;import com.qlangtech.tis.plugin.annotation.FormField;import com.qlangtech.tis.plugin.annotation.FormFieldType;import com.qlangtech.tis.plugin.annotation.Validator;import com.qlangtech.tis.plugin.trigger.JobTrigger;import org.apache.commons.lang.ArrayUtils;import org.apache.commons.lang.StringUtils;import java.util.ArrayList;import java.util.List;import java.util.Optional;/** * 控制前端页面上table items中的记录，例如：删除 * * @author 百岁 (baisui@qlangtech.com) * @date 2026/1/11 * @see IPluginStore.ManipuldateProcessor  如果执行删除，不需要持久化插件实现该接口就行 */public abstract class ListItemsManager extends NoStorePlaceholderPlugin {    private static final String HTTP_KEY_POST_PARAM_TARGET_ID = "targetId";    private static final String HTTP_KEY_POST_PARAM_TARGET_RESOURCE_TYPE = "targetResType";    public enum ListItemsManagerTargetResType {        BuildHistoricalRecord,        SystemErrorRecord;        public static ListItemsManagerTargetResType parse(String token) {            return ListItemsManagerTargetResType.valueOf(token);        }    }    @FormField(ordinal = 3, type = FormFieldType.MULTI_SELECTABLE, validate = {Validator.require})    public List<IdentityName> targetIds;    @FormField(ordinal = 4, advance = true, type = FormFieldType.INPUTTEXT, validate = {Validator.require})    public String targetResType;    protected ListItemsManagerTargetResType parseTargetResType() {        return ListItemsManagerTargetResType.parse(this.targetResType);    }    public final List<IdentityName> getTargetIds() {        return this.targetIds;    }    public static List<Option> getTargetIdsCandidate() {        AppAndRuntime appAndRuntime = AppAndRuntime.getAppAndRuntime();        String[] targetIds = appAndRuntime.getHttpParams(HTTP_KEY_POST_PARAM_TARGET_ID);        if (ArrayUtils.isEmpty(targetIds)) {            throw new IllegalStateException("param " + HTTP_KEY_POST_PARAM_TARGET_ID + " can not be empty");        }        List<Option> ids = new ArrayList<>();        for (String targetId : targetIds) {            ids.add(new Option(targetId).setChecked(true));        }        return ids;    }    public static String getPostTargetResourceType() {        AppAndRuntime appAndRuntime = AppAndRuntime.getAppAndRuntime();        String val = appAndRuntime.getHttpParam(HTTP_KEY_POST_PARAM_TARGET_RESOURCE_TYPE);        if (StringUtils.isEmpty(val)) {            throw new IllegalStateException("post param " + HTTP_KEY_POST_PARAM_TARGET_RESOURCE_TYPE + " can not be " + "empty");        }        return val;    }    @Override    public Descriptor<NoStorePlaceholderPlugin> getDescriptor() {        Descriptor<NoStorePlaceholderPlugin> descriptor = super.getDescriptor();        if (!BasicDesc.class.isAssignableFrom(descriptor.getClass())) {            throw new IllegalStateException("desc class must extend from:" + BasicDesc.class.getName());        }        return descriptor;    }    //    @Override    //    public final Descriptor<ListItemsManager> getDescriptor() {    //    }    protected static class BasicDesc extends Descriptor<ListItemsManager> implements FormFieldType.IMultiSelectValidator {    }}